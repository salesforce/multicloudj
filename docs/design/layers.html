<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/multicloudj/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/multicloudj/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(1)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(1) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(1) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/multicloudj/assets/js/vendor/lunr.min.js"></script> <script src="/multicloudj/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Layers | MulticloudJ</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Layers" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Substrate Agnostic Cloud SDK for Java" /> <meta property="og:description" content="Substrate Agnostic Cloud SDK for Java" /> <link rel="canonical" href="https://opensource.salesforce.com/multicloudj/design/layers.html" /> <meta property="og:url" content="https://opensource.salesforce.com/multicloudj/design/layers.html" /> <meta property="og:site_name" content="MulticloudJ" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Layers" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Substrate Agnostic Cloud SDK for Java","headline":"Layers","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://opensource.salesforce.com/multicloudj/assets/images/multicloudj-logo.png"}},"url":"https://opensource.salesforce.com/multicloudj/design/layers.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/multicloudj/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="MulticloudJ"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/multicloudj/" class="nav-list-link">MultiCloudJ Overview</a></li><li class="nav-list-item"><a href="/multicloudj/getting-started/" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Usage Guides category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/multicloudj/guides/" class="nav-list-link">Usage Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/multicloudj/guides/sts-guide.html" class="nav-list-link">How to STS</a></li><li class="nav-list-item"><a href="/multicloudj/guides/blobstore-guide.html" class="nav-list-link">How to Blob store</a></li><li class="nav-list-item"><a href="/multicloudj/guides/docstore-guide.html" class="nav-list-link">How to Docstore</a></li><li class="nav-list-item"><a href="/multicloudj/guides/conformance-tests-guide.html" class="nav-list-link">How to: Conformance tests in multicloudj</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Design category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/multicloudj/design/" class="nav-list-link">Design</a><ul class="nav-list"><li class="nav-list-item"><a href="/multicloudj/design/layers.html" class="nav-list-link">Layers</a></li><li class="nav-list-item"><a href="/multicloudj/design/flexibility.html" class="nav-list-link">Flexibility</a></li><li class="nav-list-item"><a href="/multicloudj/design/errors.html" class="nav-list-link">Exception Handling</a></li></ul></li><li class="nav-list-item"><a href="/multicloudj/api-java-doc.html" class="nav-list-link">Api Documentation</a></li></ul> </nav> <hr> <p style="text-align: center; font-size: 0.8rem; color: #aaa;"> This site if maintained by the MulticloudJ team. </p> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search MulticloudJ" aria-label="Search MulticloudJ" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/multicloudj/design/">Design</a></li> <li class="breadcrumb-nav-list-item"><span>Layers</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="layers"> <a href="#layers" class="anchor-heading" aria-labelledby="layers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Layers </h1> <h2 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction </h2> <p>The Substrate SDK uses a layered architecture to provide a clean separation between the public API, internal abstractions, and provider-specific implementations. This architecture enables:</p> <ul> <li>A consistent, substrate-agnostic experience for end users</li> <li>Easy addition of new cloud providers</li> <li>Clear separation of concerns</li> <li>Maintainable and testable code</li> </ul> <h2 id="components"> <a href="#components" class="anchor-heading" aria-labelledby="components"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Components </h2> <p><img src="layers.png" alt="Layers Architecture" /></p> <p>The architecture consists of three main layers:</p> <ol> <li><strong>Portable Layer</strong> (Top) - The public-facing API that users interact with</li> <li><strong>Driver Layer</strong> (Middle) - The abstraction layer that defines common interfaces</li> <li><strong>Provider Layer</strong> (Bottom) - The implementation layer for specific cloud providers</li> </ol> <h2 id="portable-layer"> <a href="#portable-layer" class="anchor-heading" aria-labelledby="portable-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Portable Layer </h2> <p>The portable layer is the most important and front-facing layer for end users. End users should mostly interact with the portable Layer to make cloud service calls. The portable Layer should expose all necessary functions/APIs for the end user. For example, for a blobstore service, it can expose methods like upload, download, delete, etc., through the portable Layer.</p> <h3 id="characteristics-of-an-ideal-portable-layer"> <a href="#characteristics-of-an-ideal-portable-layer" class="anchor-heading" aria-labelledby="characteristics-of-an-ideal-portable-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Characteristics of an ideal portable Layer: </h3> <ol> <li>The portable Layer should be substrate-agnostic, containing no substrate-specific logic. It should offer a substrate-agnostic experience for the end user.</li> <li>The portable Layer should accept the substrate(provider) value from the end user and initiate the appropriate session on that substrate. (We might consider that empty provider will pick whatever provider it finds first in the classpath, if required).</li> <li>The portable Layer should allow users to provide substrate-agnostic inputs such as region name, credentials through a credentials provider defined in Substrate SDK, bucket name (for blob services), etc.</li> <li>The portable Layer should only expose functions that are supported across all substrates. It should not support or expose features that work on one substrate but not on others.</li> <li>The portable Layer should strive to provide the best experience for the end user, requiring as little information as possible.</li> </ol> <h3 id="example-usage-of-the-portable-layer-for-blob-storage-and-uploading-the-blob"> <a href="#example-usage-of-the-portable-layer-for-blob-storage-and-uploading-the-blob" class="anchor-heading" aria-labelledby="example-usage-of-the-portable-layer-for-blob-storage-and-uploading-the-blob"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example usage of the portable Layer for blob storage and uploading the blob: </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// hardcodes for illustration purposes values should be outside of the service code</span>
<span class="nc">String</span> <span class="n">substrate</span> <span class="o">=</span> <span class="s">"aws"</span>
<span class="nc">String</span> <span class="n">region</span> <span class="o">=</span> <span class="s">"us-east-1"</span>

<span class="c1">// Setting up session credentials - </span>
<span class="c1">// these are optional and ideally in prod, this is not required</span>
<span class="c1">// since the k8s pods are set with default credentials and Substrate SDK</span>
<span class="c1">// uses the default credentials in that case.</span>
<span class="nc">StsCredentials</span> <span class="n">credentials</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StsCredentials</span><span class="o">(</span>
        <span class="s">"accessKeyId"</span><span class="o">,</span>
        <span class="s">"accessKeySecret"</span><span class="o">,</span>
        <span class="s">"sessionToken"</span><span class="o">);</span>
<span class="nc">CredentialsOverrider</span> <span class="n">credsOverrider</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CredentialsOverrider</span>
        <span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="nc">CredentialsType</span><span class="o">.</span><span class="na">SESSION</span><span class="o">).</span><span class="na">withSessionCredentials</span><span class="o">(</span><span class="n">credentials</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// Initiate the substrate agnostic BucketClient</span>
<span class="nc">BucketClient</span> <span class="n">client</span>  <span class="o">=</span> <span class="nc">BucketClient</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="n">substrate</span><span class="o">)</span>        
        <span class="o">.</span><span class="na">withBucket</span><span class="o">(</span><span class="s">"chameleon-java"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withRegion</span><span class="o">(</span><span class="n">region</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withCredentialsOverrider</span><span class="o">(</span><span class="n">credsOverrider</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// Prepare the substrate agnostic UploadRequest</span>
<span class="nc">UploadRequest</span> <span class="n">uploadRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UploadRequest</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">withKey</span><span class="o">(</span><span class="s">"bucket-path/chameleon.jpg"</span><span class="o">)</span>

<span class="c1">// Upload the content</span>
<span class="nc">UploadResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">upload</span><span class="o">(</span><span class="n">uploadRequest</span><span class="o">,</span> <span class="s">"dummy-content"</span><span class="o">);</span>
</code></pre></div></div> <p>The above example demonstrates that the end user wants to open the client for the blob storage in the AWS substrate to the bucket “chameleon-java” in the region “us-east-1”. The client is used to upload/write the blob in the bucket.</p> <p>In this example, the portable fulfills all the requirements as discussed above:</p> <ol> <li>There is no substrate specific logic exposed on the portable Layer. From the code block, there is no substrate specific exposure and this logic works in the same manner for other substrates by just providing a different substrate value.</li> <li>portable Layer forces the client the provide a substrate value, it doesn’t assume or interpret the substrate based on the runtime.</li> <li>It provides a way to supply inputs to open the session in a substrate agnostic manner.</li> <li>It asks the minimum amount of information from the end user without knowing the internals of the SDK.</li> </ol> <h2 id="driver-layer"> <a href="#driver-layer" class="anchor-heading" aria-labelledby="driver-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Driver Layer </h2> <p>The driver layer is a layer behind the portable Layer which defines the abstract functions and implementations for each substrate/provider. The driver layer can also include wrapper logic on top of abstract functions to further simplify portable Layer.</p> <h3 id="structure"> <a href="#structure" class="anchor-heading" aria-labelledby="structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Structure </h3> <p>The basic structure of abstract Blob Store looks like this which defines some variables required for the provider implementation such as region and the provider id:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstracBlobtore</span> <span class="o">{</span>

    <span class="kd">protected</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">region</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">bucket</span><span class="o">;</span>

    <span class="c1">// Abstract methods for substrate-specific implementations</span>
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="nc">UploadResponse</span> <span class="nf">doUpload</span><span class="o">(</span><span class="nc">UploadRequest</span> <span class="n">uploadRequest</span><span class="o">);</span>
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="nc">DownloadResponse</span> <span class="nf">doDownload</span><span class="o">(</span><span class="nc">DownloadRequest</span> <span class="n">downloadRequest</span><span class="o">);</span>
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">doDelete</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="why-do-need-a-separate-driver-layer"> <a href="#why-do-need-a-separate-driver-layer" class="anchor-heading" aria-labelledby="why-do-need-a-separate-driver-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Why do need a separate driver layer? </h3> <p>While it’s possible to achieve the abstraction of service capabilities without this driver layer and instead make the portable layer an abstract class, there are numerous benefits to keeping the portable layer separate. These benefits include:</p> <h4 id="separation-of-concerns"> <a href="#separation-of-concerns" class="anchor-heading" aria-labelledby="separation-of-concerns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Separation of concerns: </h4> <p>Abstract classes deal with internal code of SDK and abstract methods for providers to implement where as portable Layer or client is all about external facing code. We can keep the portable Layer light weight and to the point. Driver abstraction consist of:</p> <ol> <li>Common methods for logic which applies to all providers</li> <li>Abstract methods to be implemented by providers</li> </ol> <h4 id="prevention-of-leaky-abstractions"> <a href="#prevention-of-leaky-abstractions" class="anchor-heading" aria-labelledby="prevention-of-leaky-abstractions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prevention of leaky abstractions: </h4> <p>Having a separate portable Layer prevents the leaky abstractions because the client doesn’t have to deal with or access the driver layer which might expose some internals.</p> <h4 id="maintainability"> <a href="#maintainability" class="anchor-heading" aria-labelledby="maintainability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Maintainability: </h4> <p>Changing the internal implementations are comparatively safe without breaking portable Layer contracts.</p> <h4 id="testing"> <a href="#testing" class="anchor-heading" aria-labelledby="testing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing: </h4> <p>End users have simple portable layer for mocks and testing.</p> <h3 id="example"> <a href="#example" class="anchor-heading" aria-labelledby="example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example: </h3> <p>For instance, the upload method in BucketClient have multiple methods in the backend, such as validateContent to validate if the content is in the right format which is common for all providers. This validateContent method should be internal and not exposed to end users, therefore it can be part of driver layer and keep the BucketClient purely public.</p> <p>Secondly, if we have a prepContent abstraction function in driver which should be implemented by all the provider implementations to prepareContent for specific substrate. Now, let’s say each substrate appends the content with some prefix bytes which are substrate specific. So the upload method is executed as follow behind the scenes:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">UploadResponse</span> <span class="nf">upload</span><span class="o">(</span><span class="nc">UploadRequest</span> <span class="n">uploadRequest</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">validation</span><span class="o">();</span> <span class="o">&lt;-</span> <span class="k">this</span> <span class="n">is</span> <span class="n">common</span> <span class="n">validation</span> <span class="k">for</span> <span class="n">all</span> <span class="n">substrates</span>
   <span class="nf">prepContent</span><span class="o">();</span> <span class="o">&lt;-</span> <span class="k">this</span> <span class="n">is</span> <span class="n">provider</span> <span class="n">specific</span> <span class="n">prep</span> <span class="n">content</span>
   <span class="nf">doUpload</span><span class="o">();</span> <span class="k">this</span> <span class="n">is</span> <span class="n">provider</span> <span class="n">specific</span> <span class="n">upload</span> <span class="n">of</span> <span class="n">the</span> <span class="n">content</span>
<span class="o">}</span>
</code></pre></div></div> <p>Basically we might have several methods which the end user doesn’t care about and should be completely abstracted from the users. These functions should be placed in driver layer, keeping the portable layer purely public and sanitized.</p> <h2 id="provider-layer"> <a href="#provider-layer" class="anchor-heading" aria-labelledby="provider-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Provider Layer </h2> <p>Provider layer implements the driver layer for each substrate. Provider layer is for each provider or substrate which powers the API calls from the end users to make substrate specific calls. In the below code example: AWSBlobStore is the provider for blob/blobstore for AWS substrate and implements all the abstract functions in the AWS substrate.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AWSBlobStore</span> <span class="kd">extends</span> <span class="nc">AbstractBlobStore</span> <span class="o">{</span>
    <span class="nc">S3Client</span> <span class="n">s3Client</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">AWSBlobStore</span><span class="o">(</span><span class="nc">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">s3Client</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// code logic to build the s3Client by information from builder</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doUploadFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="nc">String</span> <span class="n">filePath</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">metadata</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="nc">PutObjectRequest</span> <span class="n">putOb</span> <span class="o">=</span> <span class="nc">PutObjectRequest</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">bucket</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">bucketName</span><span class="o">)</span>
                <span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
                <span class="o">.</span><span class="na">metadata</span><span class="o">(</span><span class="n">metadata</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="n">s3Client</span><span class="o">.</span><span class="na">putObject</span><span class="o">(</span><span class="n">putOb</span><span class="o">,</span> <span class="nc">RequestBody</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">filePath</span><span class="o">)));</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Successfully placed object"</span> <span class="o">+</span> <span class="s">" into bucket "</span> <span class="o">+</span> <span class="n">bucketName</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">builder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Builder</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="kd">extends</span> <span class="nc">AbstractBlobStore</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="nc">AwsBlobStore</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nf">Builder</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">providerId</span><span class="o">(</span><span class="s">"aws"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">AwsBlobStore</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">AwsBlobStore</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="best-practices"> <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices </h2> <ol> <li><strong>Keep the Portable Layer Clean</strong> <ul> <li>Only expose substrate-agnostic APIs</li> <li>Validate inputs before passing to driver layer</li> <li>Handle common error cases</li> </ul> </li> <li><strong>Driver Layer Design</strong> <ul> <li>Define clear interfaces</li> <li>Include common validation logic</li> <li>Provide default implementations where possible</li> <li>Document expected behavior</li> </ul> </li> <li><strong>Provider Implementation</strong> <ul> <li>Follow the driver layer contract strictly</li> <li>Handle provider-specific edge cases</li> <li>Implement proper error handling</li> <li>Add provider-specific logging</li> </ul> </li> </ol> <h2 id="common-pitfalls"> <a href="#common-pitfalls" class="anchor-heading" aria-labelledby="common-pitfalls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common Pitfalls </h2> <ol> <li><strong>Leaky Abstractions</strong> <ul> <li>Avoid exposing provider-specific types in the portable layer</li> <li>Don’t let provider-specific exceptions bubble up</li> <li>Keep provider-specific configuration internal</li> </ul> </li> <li><strong>Inconsistent Behavior</strong> <ul> <li>Ensure all providers implement the same behavior</li> <li>Handle edge cases consistently</li> <li>Document any provider-specific limitations</li> </ul> </li> <li><strong>Performance Issues</strong> <ul> <li>Avoid unnecessary abstraction layers</li> <li>Cache provider clients when possible</li> <li>Use efficient data structures</li> </ul> </li> </ol> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
